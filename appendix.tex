%!TEX root=main.tex
\clearpage\section{Appendix}
\paragraph{\bf Proof of Claim in \cref{prop:LiftedPrimPoly}}
\(\exists h(x):\: (x^k - 1)h(x) \equiv 1 \pmod{p^m, f_m(x)}\)
\begin{ext_proof}\label{proof:LiftedPrimPoly}
    Since \(0 < k < N\), \(x^k - 1 \pmod{p, f(x)}\) is nonzero and has a multiplicative inverse \(h_1(x)\), i.e., \((x^k - 1)h_1(x) \equiv 1 \pmod{p, f_m(x)}\) (recall that \(\Z[x]/(p, f(x)) = \Z[x]/(p, f_m(x))\) is a field). We are going to lift the inverse \(\bmod \  p\) to one \(\bmod \  p^m\). To do so it is most convenient to employ a technique known as Newton-Raphson division~\cite{MISC:WikiNewton}

    \smallskip
    \noindent{\bf Newton-Rhaphson division: }Let \(l > 0\). Suppose \(\exists h_l(x)\) s.t. \((x^k - 1)h_l(x) \equiv 1 \pmod{p^l, f_m(x)}\). Define
    \[h_{l+1}(x) = 2 h_l(x) - (x^k - 1)h_l(x)^2\]
    Then \((x^k - 1)h_{l+1}(x) \equiv 1 \pmod{p^{l+1}, f_m(x)}\)

    \noindent\emph{proof of lifting} \quad Write \((x^k - 1)h_l(x) = 1 = p^l M_l(x) + f_m(x) N_l(x)\) for some polynomials \(M_l(x), N_l(x)\). Then
    \begin{align*}
        &(x^k - 1)^2h_l(x)^2 = 1 + 2p^l M_l(x) + p^{l+1}(p^{l-1}M_l(x)^2) + f_m(x)\left(f_m(x) N_l(x)^2  \right.\\
        &\left. + 2 N_l(x) (1 + p^l M_l(x)) \right) \\
        &2(x^k - 1)h_l(x) = 2 + 2p^l M_l(x) + f_m(x) N_l(x) \\
        \implies &(x^k - 1)h_{l+1}(x) = 1 + p^{l+1} M_{l+1}(x) + f_m(x) N_{l+1}(x)
    \end{align*}
    for some polynomials \(M_{l+1}(x), N_{l+1}(x)\). Therefore we can use Newton-Rhaphson division to lift the inverse up to \(\bmod \  p^m\). This shows that \(x^k - 1\) and the claim is proven. \hfill \qed
\end{ext_proof}

\paragraph{\bf Proof of \cref{prop:LiftPrimOnly}}
\begin{ext_proof}\label{proof:LiftPrimOnly} 
    Let \(\mathcal{Z}_p\) be the ring of p-adic integers and \(\mathcal{Q}_p\) the field of p-adic rationals. Since \(M\) is coprime to \(p\) the polynomial \(x^M - 1\) has \(M\) distinct roots of unity over an extension field of \(\mathcal{Q}_p\).

    By Hensel Lifting Lemma~\cref{thm:HenselLifting}, there exists \(f_{k+1}(x), g(x) \in \Z[x]\) such that \(f_{k+1}(x) \mid x^M - 1\) over \(\Z_{p^{k+1}}[x]\) and \(f_{k+1}(x) \equiv f_k(x) + p^k g(x) \pmod{p^{k+1}}\). Therefore item 1 and 2 of \cref{prop:LiftPrimOnly} are immediate, and it remains to show item 3.

    Moreover, if \(\alpha_k\) is a root of \(f_k(x)\) over \(\Z_{p^k}\), namely \(f_k(\alpha_k) \equiv 0 \pmod{p^k}\). There would exist a root \(\alpha_{k+1} = \alpha_k + p^k \delta\), where \(\delta\) lies in an extension field of \(\mathcal{Q}_p\), of \(f_{k+1}(x)\) over \(\Z_{p^{k+1}}\). In other words, \(f_{k+1}(\alpha_{k+1}) \equiv 0 \pmod{p^{k+1}}\).

    Since \(f_k(x) \mid x^M - 1\) over \(\Z_{p^k}[x]\), there exists an \(\epsilon\) in an extension field of \(\mathcal{Q}_p\) such that \(\alpha_k^M = 1 + p^k \epsilon\). Because
    \begin{align*}
        &\alpha_{k+1}^p = (\alpha_k + p^k \delta)^p = \alpha_k^p + O(p^{k+1}) \equiv \alpha_k^p \pmod{p^{k+1}} \\
        &\alpha_{k+1}^{pM} = (\alpha_k + p^k \delta)^{pM} = \alpha_k^{pM} + O(p^{k+1}) = (1 + p^k \epsilon)^p + O(p^{k+1}) \\
        &= 1 + O(p^{k+1}) \equiv 1 \pmod{p^{k+1}}
    \end{align*}
    Hence the \(p\textsuperscript{th}\) power of distinct roots \(\alpha_k\) of \(f_k(x)\) over \(\Z_{p^k}\) are all distinct roots of \(x^M - 1\) over \(\Z_{p^{k+1}}\). In addition, \(\alpha_{k+1}^p \equiv \alpha_k^p \equiv \alpha_k \pmod{p}\), and we must therefore have \(f_k(\alpha_k^p) \equiv 0 \pmod{p^k}\).

    The roots of \(f_{k+1}\) over \(\Z_{p^{k+1}}\) are, up to \(\bmod \  p^{k+1}\) the \(p\textsuperscript{th}\) power of all the roots of \(f_k(x)\) over \(\Z_{p^k}\). Therefore item 3 is proven. \hfill \qed
\end{ext_proof}

\paragraph{\bf Proof of \cref{thm:CircMult2}}
\begin{ext_proof} \label{proof:CircMult2} 
    Assume the recursion step gives the correct result, then \(\forall 0 \le i < B\):
    \begin{align*}
        \bm{c}_i &= \left(B r^{B-1-i}\right)^{-1} \sum_{j=0}^{B-1} \omega^{ij} \bm{e}_j \\
        &=  \left(B r^{B-1-i}\right)^{-1} \sum_{j=0}^{B-1} \left( \omega^{ij} \left(\sum_{k=0}^{B-1}r^k \omega^{kj} \bm{A}_k\right) \left(\sum_{l=0}^{B-1}r^{B-1-l} \omega^{-lj} \bm{b}_l\right)\right) \\
        &= B^{-1} \sum_{j,k,l} r^{i+k-l} \omega^{j(i+k-l)} \bm{A}_k \bm{b}_l = \sum_{k,l}r^{i+k-l} \bm{A}_k \bm{b}_l \cdot B^{-1}\sum_j \omega^{j(i+k-l)} \\
        &= \sum_{k,l} r^{i+k-l} \bm{A}_k \bm{b}_l \cdot [l \equiv i + k \pmod{B}]= \sum_{k=0}^{B-1-i} \bm{A}_k \bm{b}_{i+k} + \sum_{k=B-i}^{B-1}f \bm{A}_k \bm{b}_{i+k-B}
    \end{align*}
    The final expression is exactly the \(i\textsuperscript{th}\) block of the product \(\bm{A} \bm{b}\)

    Next we show that \(\forall 0 \le k < B\), the matrix \(\bm{M}_k\) is a \(\omega^k r\)-circulant \(\frac{N}{B} \times \frac{N}{B}\) matrix.

    Because \(\bm{A}\) is \(f\)-circulant, \(\exists (a)_{i=0}^{N-1}\) such that \(\bm{A}_{i,j} = \begin{cases}
        a_{j-i} & \text{if \(i \le j\)} \\
        f a_{N+j-i} & \text{otherwise}
    \end{cases}\). 
    
    For \(0 \le i < \frac{N}{B}\), define \(\alpha_i = \sum_{j=0}^{B-1} \omega^{jk}r^j a_{\frac{N}{B} j + i}\).

    If \(0 \le i \le j < \frac{N}{B}\):
    \[
        (\bm{M}_k)_{i,j} = \sum_{l=0}^{B-1} r^l \omega^{kl} (\bm{A}_l)_{i,j} = \sum_{l=0}^{B-1} r^l \omega^{kl} \bm{A}_{i, \frac{N}{B}l + j}
        = \sum_{l=0}^{B-1}r^l \omega^{kl} a_{\frac{N}{B}l + j - i} = \alpha_{j-i}
    \]

    If \(0 \le j < i < \frac{N}{B}\):
    \begin{align*}
        (\bm{M}_k)_{i,j} &= \sum_{l=0}^{B-1}r^l \omega^{kl} \bm{A}_{i, \frac{N}{B}l + j}= f a_{N + j - i} + \sum_{l=1}^{B-1}r^l \omega^{kl} a_{\frac{N}{B}l + j - i} \\
        &= \omega^k r \left(\sum_{l=0}^{B-2} r^l \omega^{kl} a_{\frac{N}{B} + \frac{N}{B}l + j - i}\right) + \omega^k r \left(r^{B-1} \omega^{k(B-1) a_{\frac{N}{B} + \frac{(B-1)N}{B}+j-i}}\right) \\
        &= \omega^k r \left(\alpha_{\frac{N}{B} + j - i}\right)
    \end{align*}
    Therefore \(\bm{M}_k\) is an \(\omega^k r\)-circulant matrix.

    Finally, the divide an conquer nature of the algorithm implies that the time complexity of \cref{alg:Mult2} is \(O(N \log N)\).
\end{ext_proof}

\paragraph{\bf Proof of \cref{prop:TensorPrimeFactor}}
\begin{ext_proof} \label{proof:TensorPrimeFactor}
    We use induction on the number of coprime factors \(n\) of \(N\).

    If \(n = 2,\, N = q_1 q_2^e\). Let \(N_1 = q_1\), \(N_2 = q_2^e\), \(\bm{P}_1\) the stride permutation matrix with respect to \(N = N_1 N_2\). Item 1 to 3 in \cref{prop:AgrawalCooley} implies
    \begin{align*}
        &\left(\bm{V}_{q_1} \otimes \bm{I}_{q_2^e}\right) \bm{P}_1 \bm{w} \\
        &= \left(\bm{V}_{q_1} \otimes \bm{I}_{q_2^e}\right) \left(\bm{P}_1 \bm{H} \bm{P}_1^{-1}\right) \left(\bm{V}_{q_1}^{-1} \otimes \bm{I}_{q_2^e}\right) \cdot \left(\bm{V}_{q_1} \otimes \bm{I}_{q_2^e}\right) \bm{P}_1 \bm{v} \\
        &\implies \bm{V}_{(2)} \bm{w} = \left(\bm{V}_{(2)} \bm{H} \bm{V}_{(2)}^{-1}\right) \cdot \bm{V}_{(2)} \bm{v}
    \end{align*}
    And that \(\bm{V}_{(2)} \bm{H} \bm{V}_{(2)}^{-1}\) is a block-diagnonal matrix, each block a circulant matrix of dimension \(q_2^e \times q_2^e\). This proves the base case.

    Assume the assumption holds for the number of coprime factors \(1, 2 \ldots n\). Now if \(N = q_1 q_2 \ldots q_n q_{n+1}^e\), we can also write \(N = q_1 q_2 \ldots q_{n-1} Q_n\), where \(Q_n = q_n q_{n+1}^e\). By inductive hypothesis: \(\bm{V}_{(n)} \bm{w} = \left(\bm{V}_{(n)} \bm{H} \bm{V}_{(n)}^{-1}\right) \cdot \bm{V}_{(n)} \bm{v}\), where \(\bm{V}_{(n)}\) is as in \cref{prop:TensorPrimeFactor} except we replace \(\bm{I}_{q_n^e}\) by \(\bm{I}_{Q_n}\). Again by inductive hypothesis \(\bm{V}_{(n)} \bm{H} \bm{V}_{(n)}^{-1}\) is a block-diagonal matix, each block a circulant matrix of dimension \(Q_n \times Q_n\).

    Again Item 1 to 3 in \cref{prop:AgrawalCooley} says that for \(Q_n = q_n q_{n+1}^e\), \(P_n\) the stride permutation matrix with respect to the factorization \(Q_n = q_n q_{n+1}^e\), and for any \(Q_n \times Q_n\) circulant matrix \(\bm{U}\):
    \[\left(\bm{V}_{q_n} \otimes \bm{I}_{q_{n+1}^e}\right) \left(\bm{P}_n \bm{U} \bm{P}_n^{-1}\right) \left(\bm{V}_{q_n}^{-1} \otimes \bm{I}_{q_{n+1}^e}\right)\]
    is a block-diagnoal matrix, each block is circulant of dimension \(q_{n+1}^e \times q_{n+1}^e\).

    Apply this operator to each circulant block within \(\bm{V}_{(n)}\), we obtain
    \begin{multline*}
        \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{V}_{q_n} \otimes \bm{I}_{q_{n+1}^e}\right) \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{P}_n\right) \left(\bm{V}_{(n)} \bm{H} \bm{V}_{(n)}^{-1}\right) \\
        \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{P}_n^{-1}\right) \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{V}_{q_n}^{-1} \bm{I}_{q_{n+1}^e}\right)
    \end{multline*}
    is a block diagonal matrix, each block circulant of dimension \(q_{n+1}^e \times q_{n+1}^e\). But
    \begin{align*}
        &\left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{V}_{q_n} \otimes \bm{I}_{q_{n+1}^e}\right) \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{P}_n\right) \bm{V}_{(n)} \\
        &= \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{V}_{q_n} \otimes \bm{I}_{q_{n+1}^e}\right) \left(\bm{I}_{q_1\ldots q_{n-1}} \otimes \bm{P}_n\right) \left(\bm{V}_{q_1} \otimes \bm{V}_{q_2} \otimes \ldots \otimes \bm{V}_{q_{n-1}} \otimes \bm{I}_{Q_n}\right) \\
        &\left(\bm{I}_{N_{n-2}} \otimes \bm{P}_{n-1}\right) \dots \left(\bm{I}_{N_1} \otimes \bm{P}_2\right) \bm{P}_1 \\
        &= \left(\bm{V}_{q_1} \otimes \ldots \otimes \bm{V}_{q_{n}} \otimes \bm{I}_{q_{n+1}^e}\right) \left(\bm{I}_{N_{n-1}} \otimes \bm{P}_n\right) \dots \left(\bm{I}_{N_1} \otimes \bm{P}_2\right) \bm{P}_1 \\
        &= \bm{V}_{(n+1)}
    \end{align*}
    where \(N_{n-1} = q_1 q_2 \ldots q_n\) and \(Q_n = q_n q_{n+1}^e\). In addition, we use the mix product property of tensor products to move around and combine the components in order to obtain the second last equality. This proves the induction step.
\end{ext_proof}

\subsection{More Experimental Setups and Results} \label{subsection:more_experiments}
{\bf \(p = 17, \text{ Length} = 1000\)}: We let \(N = 2880 = 5 * 3^2 * 2^6 \mid 17^{4} - 1\). We find a primitve degree \(4\) polynomial \(\bmod \  17\): \(f_{4}(x) = x^4 + 7x^2 + 10x + 3\) and use \cref{alg:HenselLift} to lift the polynomial over prime powers \(17^2, 17^4, 17^8\). Use \(x^{29} \) as a principal \(N\textsuperscript{th}\) root of unity and finally employ \cref{alg:PrimePowerConvolution} and \cref{alg:Mult2}.

{\bf \(p = 17, \text{ Length} = 80000\)}: We let \(N = 2880 = 29 * 5 * 3^2 * 2^7 \mid 17^{8} - 1\). We find a primitve degree \(8\) polynomial \(\bmod \  17\): \(f_{8}(x) = x^8 + 11x^4 + 12x^3 + 6x + 3\) and use \cref{alg:HenselLift} to lift the polynomial over prime powers \(17^2, 17^4, 17^8\). Use \(x^{41761} \) as a principal \(N\textsuperscript{th}\) root of unity and finally employ \cref{alg:PrimePowerConvolution} and \cref{alg:Mult2}.

{\bf \(p = 31, \text{ Length} = 900\)}: We let \(N = 1920 = 5 * 3 * 2^7 \mid 31^{4} - 1\). We find a primitve degree \(4\) polynomial \(\bmod \  31\): \(f_{4}(x) = x^4 + 3x^2 + 16x + 3\) and use \cref{alg:HenselLift} to lift the polynomial over prime powers \(31^2, 31^4, 31^8\). Use \(x^{13*37} \) as a principal \(N\textsuperscript{th}\) root of unity and finally employ \cref{alg:PrimePowerConvolution} and \cref{alg:Mult2}.

{\bf \(p = 31, \text{ Length} = 10000\)}: We let \(N = 24960 = 13 * 5 * 3 * 2^7 \mid 31^{4} - 1\). Use again the primitive degree \(4\) polynomial \(\bmod \  31\): \(f_{4}(x) = x^4 + 3x^2 + 16x + 3\) and \cref{alg:HenselLift} to lift the polynomial over prime powers \(31^2, 31^4, 31^8\). Use \(x^{37} \) as a principal \(N\textsuperscript{th}\) root of unity and finally employ \cref{alg:PrimePowerConvolution} and \cref{alg:Mult2}.

\paragraph{\bf Results} See \cref{tab:mod17_2_a,tab:mod17_4_a,tab:mod17_8_a,tab:mod31_2_a,tab:mod31_4_a,tab:mod31_8_a}.

\begin{table}[ht]
    \centering
    \begin{tabular}{|| c | c | c ||}
        \hline
        {\bf Method/Length} & \(\ \bm{1000} \ \) & \(\quad \bm{80000} \quad \) \\
        \hline
        Direct & 29 & 149945  \\
        \hline
        \Cref{alg:PrimePowerConvolution} & 299 & 27015 \\
        \hline
        Multimodular-NTT & 22 & 4166 \\
        \hline
        Flint & 2.8 & 243 \\
        \hline
    \end{tabular}
    \caption{Average time in ms for convolution when modulus is \(17^2\). We use 50 test when Length is \(\le 5000\) and 20 test data when Length \(> 5000\) }
    \label{tab:mod17_2_a}
\end{table}

\begin{table}[ht]
    \centering
    \begin{tabular}{|| c | c | c ||}
        \hline
        {\bf Method/Length} & \(\ \bm{1000} \ \) & \(\quad \bm{80000} \quad \) \\
        \hline
        Direct & 83 & 455928  \\
        \hline
        \Cref{alg:PrimePowerConvolution} & 304 & 29573 \\
        \hline
        Multimodular-NTT & 43 & 6527 \\
        \hline
        Flint & 1.6 & 377 \\
        \hline
    \end{tabular}
    \caption{Average time in ms for convolution when modulus is \(17^4\). We use 50 test when Length is \(\le 5000\) and 20 test data when Length \(> 5000\) }
    \label{tab:mod17_4_a}
\end{table}

\begin{table}[ht]
    \centering
    \begin{tabular}{|| c | c | c ||}
        \hline
        {\bf Method/Length} & \(\ \bm{1000} \ \) & \(\quad \bm{80000} \quad \) \\
        \hline
        Direct & 141 & 1231909  \\
        \hline
        \Cref{alg:PrimePowerConvolution} & 374 & 49495 \\
        \hline
        Multimodular-NTT & 66 & 8520 \\
        \hline
        Flint & 3.7 & 564 \\
        \hline
    \end{tabular}
    \caption{Average time in ms for convolution when modulus is \(17^8\). We use 50 test when Length is \(\le 5000\) and 20 test data when Length \(> 5000\) }
    \label{tab:mod17_8_a}
\end{table}

\begin{table}[ht]
    \centering
    \begin{tabular}{|| c | c | c ||}
        \hline
        {\bf Method/Length} & \(\ \bm{900} \ \) & \(\quad \bm{10000} \quad \) \\
        \hline
        Direct & 69 & 7262  \\
        \hline
        \Cref{alg:PrimePowerConvolution} & 181 & 3162 \\
        \hline
        Multimodular-NTT & 32 & 662 \\
        \hline
        Flint & 1.3 & 41.6 \\
        \hline
    \end{tabular}
    \caption{Average time in ms for convolution when modulus is \(31^2\). We use 50 test when Length is \(\le 5000\) and 20 test data when Length \(> 5000\) }
    \label{tab:mod31_2_a}
\end{table}

\begin{table}[ht]
    \centering
    \begin{tabular}{|| c | c | c ||}
        \hline
        {\bf Method/Length} & \(\ \bm{900} \ \) & \(\quad \bm{10000} \quad \) \\
        \hline
        Direct & 77 & 7206  \\
        \hline
        \Cref{alg:PrimePowerConvolution} & 190 & 3386 \\
        \hline
        Multimodular-NTT & 43 & 865 \\
        \hline
        Flint & 4.2 & 47 \\
        \hline
    \end{tabular}
    \caption{Average time in ms for convolution when modulus is \(31^4\). We use 50 test when Length is \(\le 5000\) and 20 test data when Length \(> 5000\) }
    \label{tab:mod31_4_a}
\end{table}

\begin{table}[ht]
    \centering
    \begin{tabular}{|| c | c | c ||}
        \hline
        {\bf Method/Length} & \(\ \bm{900} \ \) & \(\quad \bm{10000} \quad \) \\
        \hline
        Direct & 116 & 12588  \\
        \hline
        \Cref{alg:PrimePowerConvolution} & 244 & 4312 \\
        \hline
        Multimodular-NTT & 66 & 1302 \\
        \hline
        Flint & 4.8 & 41 \\
        \hline
    \end{tabular}
    \caption{Average time in ms for convolution when modulus is \(31^8\). We use 50 test when Length is \(\le 5000\) and 20 test data when Length \(> 5000\) }
    \label{tab:mod31_8_a}
\end{table}